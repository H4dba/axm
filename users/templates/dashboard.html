{% extends 'base.html' %}

{% block content %}
<div class="dashboard-container">
    <div class="profile-section">
        <h2>Welcome, {{ user.username }}!</h2>
        
        {% if not user.is_lichess_connected %}
            <div class="connect-lichess-box">
                <p>Connect your Lichess account to see your ratings and participate in tournaments!</p>
                <a href="{% url 'connect_lichess' %}" class="btn btn-primary">Connect Lichess Account</a>
            </div>
        {% else %}
            <div class="user-stats">
                <div class="ratings-box">
                    <h3>Your Lichess Ratings</h3>
                    <div class="ratings-grid">
                        {% if user.lichess_rating_bullet %}
                        <div class="rating-card">
                            <h4>Bullet</h4>
                            <span class="rating">{{ user.lichess_rating_bullet }}</span>
                        </div>
                        {% endif %}
                        
                        {% if user.lichess_rating_blitz %}
                        <div class="rating-card">
                            <h4>Blitz</h4>
                            <span class="rating">{{ user.lichess_rating_blitz }}</span>
                        </div>
                        {% endif %}
                        
                        {% if user.lichess_rating_rapid %}
                        <div class="rating-card">
                            <h4>Rapid</h4>
                            <span class="rating">{{ user.lichess_rating_rapid }}</span>
                        </div>
                        {% endif %}
                        
                        {% if user.lichess_rating_classical %}
                        <div class="rating-card">
                            <h4>Classical</h4>
                            <span class="rating">{{ user.lichess_rating_classical }}</span>
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% if current_games %}
                <div class="current-games">
                    <h3>Current Games</h3>
                    <div class="games-list">
                        {% for game in current_games %}
                        <div class="game-card">
                            <p>vs {{ game.opponent }}</p>
                            <a href="https://lichess.org/{{ game.gameId }}" target="_blank" class="btn btn-sm btn-primary">
                                Watch Game
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if recent_games %}
                <div class="recent-games">
                    <h3>Recent Games</h3>
                    <div class="games-list">
                        {% for game in recent_games %}
                        <div class="game-card">
                            <p>{{ game.white.name }} vs {{ game.black.name }}</p>
                            <p>Result: {{ game.winner|default:"Draw" }}</p>
                            <a href="https://lichess.org/{{ game.id }}" target="_blank" class="btn btn-sm btn-secondary">
                                View Game
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        {% endif %}
    </div>

    <div class="leaderboard-section">
        <h3>Club Leaderboard</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Player</th>
                    <th>Rapid Rating</th>
                    <th>Blitz Rating</th>
                </tr>
            </thead>
            <tbody>
                {% for player in top_players %}
                <tr {% if player.username == user.username %}class="current-user"{% endif %}>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ player.username }}</td>
                    <td>{{ player.lichess_rating_rapid|default:"-" }}</td>
                    <td>{{ player.lichess_rating_blitz|default:"-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    .dashboard-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .profile-section, .leaderboard-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .ratings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .rating-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        text-align: center;
    }

    .games-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .game-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        text-align: center;
    }

    .current-user {
        background-color: #e3f2fd;
    }

    .btn {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 4px;
        text-decoration: none;
        margin: 5px;
    }

    .btn-primary {
        background: #2196f3;
        color: white;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn-sm {
        padding: 4px 8px;
        font-size: 0.875rem;
    }
</style>
{% endblock %}