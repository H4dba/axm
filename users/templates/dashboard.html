{% extends 'base.html' %}

{% block content %}
<div class="dashboard-container">
    <div class="profile-section">
        <h2>Bem-vindo, {{ user.username }}!</h2>
        
        {% if not user.is_lichess_connected %}
            <div class="connect-lichess-box">
                <p>Conecte sua conta Lichess para ver seus ratings e participar de torneios!</p>
                <a href="{% url 'connect_lichess' %}" class="btn btn-primary">Conectar Conta Lichess</a>
            </div>
        {% else %}
            <div class="user-stats">
                <div class="ratings-box">
                    <h3>Seus Ratings no Lichess</h3>
                    <div class="ratings-grid">
                        {% if perfil_lichess.bullet_rating %}
                        <div class="rating-card">
                            <h4>Bullet</h4>
                            <span class="rating">{{ perfil_lichess.bullet_rating }}</span>
                            <small>{{ perfil_lichess.bullet_games_played }} jogos</small>
                        </div>
                        {% endif %}
                        
                        {% if perfil_lichess.blitz_rating %}
                        <div class="rating-card">
                            <h4>Blitz</h4>
                            <span class="rating">{{ perfil_lichess.blitz_rating }}</span>
                            <small>{{ perfil_lichess.blitz_games_played }} jogos</small>
                        </div>
                        {% endif %}
                        
                        {% if perfil_lichess.rapid_rating %}
                        <div class="rating-card">
                            <h4>Rapid</h4>
                            <span class="rating">{{ perfil_lichess.rapid_rating }}</span>
                            <small>{{ perfil_lichess.rapid_games_played }} jogos</small>
                        </div>
                        {% endif %}
                        
                        {% if perfil_lichess.classical_rating %}
                        <div class="rating-card">
                            <h4>Classical</h4>
                            <span class="rating">{{ perfil_lichess.classical_rating }}</span>
                            <small>{{ perfil_lichess.classical_games_played }} jogos</small>
                        </div>
                        {% endif %}
                        
                        {% if perfil_lichess.puzzles_rating %}
                        <div class="rating-card">
                            <h4>Puzzles</h4>
                            <span class="rating">{{ perfil_lichess.puzzles_rating }}</span>
                            <small>{{ perfil_lichess.puzzles_solved }} resolvidos</small>
                        </div>
                        {% endif %}
                    </div>
                    <div class="update-section">
                        <a href="{% url 'atualizar_dados_lichess' %}" class="btn btn-success">
                            ðŸ”„ Atualizar Dados do Lichess
                        </a>
                    </div>
                </div>

                {% if current_games %}
                <div class="current-games">
                    <h3>Jogos Atuais</h3>
                    <div class="games-list">
                        {% for game in current_games %}
                        <div class="game-card">
                            <div class="players">
                                <div class="white-player">
                                    <span class="player-name">{{ game.white.name }}</span>
                                    <span class="player-rating">({{ game.white.rating }})</span>
                                </div>
                                <div class="vs">vs</div>
                                <div class="black-player">
                                    <span class="player-name">{{ game.black.name }}</span>
                                    <span class="player-rating">({{ game.black.rating }})</span>
                                </div>
                            </div>
                            <div class="game-info">
                                <span class="game-speed">{{ game.speed|title }}</span>
                                {% if game.winner == 'white' %}
                                    <span class="game-result">White won</span>
                                {% elif game.winner == 'black' %}
                                    <span class="game-result">Black won</span>
                                {% else %}
                                    <span class="game-result">Draw</span>
                                {% endif %}
                            </div>
                            <a href="https://lichess.org/{{ game.id }}" target="_blank" class="btn btn-secondary">
                                Ver Jogo
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                {% if recent_games %}
                <div class="recent-games">
                    <h3>Jogos Recentes</h3>
                    <div class="games-list">
                        {% for game in recent_games %}
                        <div class="game-card">
                            <p>{{ game.white.name }} vs {{ game.black.name }}</p>
                            <p>Result: {{ game.winner|default:"Draw" }}</p>
                            <a href="https://lichess.org/{{ game.id }}" target="_blank" class="btn btn-sm btn-secondary">
                                Ver Jogo
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        {% endif %}
    </div>

    <div class="leaderboard-section">
        <h3>Ranking do Clube</h3>
        <table class="table">
            <thead>
                <tr>
                    <th>PosiÃ§Ã£o</th>
                    <th>Jogador</th>
                    <th>Rating Rapid</th>
                    <th>Rating Blitz</th>
                </tr>
            </thead>
            <tbody>
                {% for player in top_players %}
                <tr {% if player.username == user.username %}class="current-user"{% endif %}>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ player.username }}</td>
                    <td>{{ player.rapid_rating|default:"-" }}</td>
                    <td>{{ player.blitz_rating|default:"-" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<style>
    .dashboard-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }

    .profile-section, .leaderboard-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .ratings-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .rating-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        text-align: center;
    }

    .games-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .game-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        text-align: center;
    }

    .current-user {
        background-color: #e3f2fd;
    }

    .btn {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 4px;
        text-decoration: none;
        margin: 5px;
    }

    .btn-primary {
        background: #2196f3;
        color: white;
    }

    .btn-secondary {
        background: #6c757d;
        color: white;
    }

    .btn-success {
        background: #28a745;
        color: white;
    }

    .update-section {
        text-align: center;
        margin-top: 20px;
        padding-top: 15px;
        border-top: 1px solid #dee2e6;
    }

    .btn-sm {
        padding: 4px 8px;
        font-size: 0.875rem;
    }
</style>
{% endblock %}